{"version":3,"sources":["webpack://bpdState/webpack/universalModuleDefinition","webpack://bpdState/webpack/bootstrap","webpack://bpdState/./src/helpers/functions.ts","webpack://bpdState/./src/helpers/errors.ts","webpack://bpdState/./src/helpers/backup.ts","webpack://bpdState/./src/helpers/copy.ts","webpack://bpdState/./src/subscriptions/subscriptions.ts","webpack://bpdState/./src/worker/worker.ts","webpack://bpdState/./src/state/state.ts","webpack://bpdState/./src/core.ts"],"names":[],"mappings":"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","file":"bpdState.core.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"bpdState\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"bpdState\"] = factory();\n\telse\n\t\troot[\"bpdState\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","export function is(obj: any) {\r\n    if (typeof obj === 'undefined' || obj === null) {\r\n        return false;\r\n    }\r\n    if (Array.isArray(obj) && obj.length === 0) {\r\n        return false;\r\n    }\r\n    if (typeof obj === 'string' && obj.length === 0) {\r\n        false;\r\n    }\r\n    return true;\r\n}\r\n\r\nexport function* counter(): Generator<number, void, unknown> {\r\n    let idx = 0;\r\n    while (true) {\r\n        let reset = yield idx++;\r\n        if (reset || idx > 200000) {\r\n            idx = 0\r\n        }\r\n    }\r\n}","export class ErrorBase extends Error {\r\n    constructor(name: string, message?: string,) {\r\n        super(message);\r\n        Object.setPrototypeOf(this, new.target.prototype);\r\n        this.name = name;\r\n    }\r\n}\r\n\r\nexport class IncorrectDataError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"IncorrectDataError\", message)\r\n    }\r\n}\r\n\r\nexport class WorkerNotReadyError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"WorkerNotReadyError\", message);\r\n    }\r\n}\r\n\r\nexport class PerformerError extends ErrorBase {\r\n    constructor(base: Error) {\r\n        super(\"PerformerError:\" + base.name, base.message);\r\n        this.stack = base.stack;\r\n    }\r\n}\r\n\r\nexport class CreateStateError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"CreateStateError\", message);\r\n    }\r\n}\r\n\r\nexport class InitStateError extends ErrorBase {\r\n    constructor(message?: string) {\r\n        super(\"InitStateError\", message);\r\n    }\r\n}\r\n\r\nexport class CommonError extends ErrorBase {\r\n    constructor(type: string, message?: string) {\r\n        super(type, message);\r\n    }\r\n}\r\n\r\nexport class StateManagerShorthandError extends ErrorBase {\r\n    constructor(type: string, message?: string) {\r\n        super(\"StateManagerShorthandError\", type + \":\" + message);\r\n    }\r\n}","export interface IStateBackup<VState> {\r\n    push(v: VState): void;\r\n    undo(): VState | undefined;\r\n    length(): number;\r\n}\r\n\r\nexport class StateBackup<VState> implements IStateBackup<VState> {\r\n    _states: VState[];\r\n    _maxCount: number;\r\n    constructor() {\r\n        this._states = [];\r\n        this._maxCount = 20\r\n    }\r\n    push(v: VState): void {\r\n        if (this._states.length >= this._maxCount) {\r\n            this._states.shift();\r\n        }\r\n        this._states.push(v);\r\n    }\r\n    undo(): VState | undefined {\r\n        if (this._states.length > 0) {\r\n            return this._states.pop();\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    length(): number {\r\n        return this._states.length;\r\n    }\r\n\r\n}","import { IObjectCopyMaker } from \"../interfaces\";\r\n\r\nexport class ObjectCopyMaker<VState> implements IObjectCopyMaker<VState> {\r\n    copy(obj: VState): VState {\r\n        if (typeof obj === 'undefined' || obj === null) {\r\n            return obj;\r\n        }\r\n        let newOne: VState | null = null;\r\n        if (['number', 'string', 'boolean'].includes(typeof obj) || Array.isArray(obj)) {\r\n            newOne = obj;\r\n        }\r\n        else {\r\n            newOne = { ...obj };\r\n        }\r\n        return newOne;\r\n    }\r\n\r\n}","import { IncorrectDataError } from \"../helpers/errors\";\r\nimport { counter, is } from \"../helpers/functions\";\r\n\r\nexport interface Subscriber<VState> {\r\n    id: string,\r\n    options?: SubscriberOptions;\r\n    callback: (state: VState) => void;\r\n}\r\n\r\nexport interface SubscriberOptions {\r\n    singleRun: boolean;\r\n}\r\n\r\ninterface ErrorCallback {\r\n    (e: Error): void;\r\n}\r\n\r\nexport interface ISubscriptionsManager<VState> {\r\n    onError(callback: (e: Error) => void): void;\r\n    subscribe(callback: (state: VState) => void, options?: SubscriberOptions): string;\r\n    unsubscribe(subscribtionId: string): void;\r\n    notify(state: VState): Promise<boolean>;\r\n    getSubscribers(): Subscriber<VState>[];\r\n}\r\n\r\nexport class SubscriptionsManager<VState> implements ISubscriptionsManager<VState>{\r\n    private _subscribers: Subscriber<VState>[];\r\n    private _onError: ErrorCallback | undefined;\r\n    private _counter: Generator<number, void, unknown>;\r\n    private _id: string;\r\n    constructor(id: string) {\r\n        if (!is(id)) {\r\n            throw new IncorrectDataError(\"Valid Id is required\");\r\n        }\r\n        this._subscribers = [];\r\n        this._id = id;\r\n        this._counter = counter();\r\n        this._onError = undefined;\r\n    }\r\n\r\n    subscribe(callback: (state: VState) => void, options?: SubscriberOptions): string {\r\n        let subscriber = this.createSubscriber(callback, options);\r\n        this._subscribers.push(subscriber);\r\n        return subscriber.id;\r\n    }\r\n\r\n    unsubscribe(subscribtionId: string): void {\r\n        if (!is(subscribtionId)) {\r\n            return;\r\n        }\r\n        let index = this._subscribers.findIndex((subscirber: Subscriber<VState>) => {\r\n            return subscirber.id === subscribtionId;\r\n        })\r\n        if (index < 0) {\r\n            return;\r\n        }\r\n        this._subscribers.splice(index, 1);\r\n    }\r\n\r\n    async notify(state: VState): Promise<boolean> {\r\n        let toRemove: string[] = []\r\n        this._subscribers.forEach(sub => {\r\n            if (sub.options && sub.options.singleRun) {\r\n                toRemove.push(sub.id);\r\n            }\r\n            try {\r\n                sub.callback(state);\r\n            } catch (e) {\r\n                toRemove.push(sub.id);\r\n                if (this._onError) {\r\n                    this._onError(e);\r\n                }\r\n            }\r\n        })\r\n        toRemove.forEach(id => this.unsubscribe(id));\r\n        return true;\r\n    }\r\n\r\n    onError(callback: (e: Error) => void) {\r\n        this._onError = callback;\r\n    }\r\n\r\n    getSubscribers(): Subscriber<VState>[] {\r\n        return [...this._subscribers];\r\n    }\r\n\r\n    private createSubscriber(callback: (state: VState) => void, options?: SubscriberOptions): Subscriber<VState> {\r\n        return {\r\n            id: this.generateId(),\r\n            options: options,\r\n            callback: callback\r\n        }\r\n    }\r\n\r\n    private generateId(): string {\r\n        return `${this._id}:${this._counter.next().value}`;\r\n    }\r\n}","import { IncorrectDataError, WorkerNotReadyError } from \"../helpers/errors\";\r\nimport { is } from \"../helpers/functions\";\r\nimport { BpdStateAction } from \"../interfaces\";\r\n\r\nexport interface OnPerformCallback<V, P> {\r\n    (action: BpdStateAction<V>): Promise<P>;\r\n}\r\n\r\nexport interface OnUpdateCallback<V, P> {\r\n    (result: P, action?: BpdStateAction<V>): void;\r\n}\r\n\r\nexport interface OnErrorCallback<V> {\r\n    (error: Error, action?: BpdStateAction<V>): void;\r\n}\r\n\r\nexport interface IBpdStateWorker<V, P> {\r\n    perform(action: BpdStateAction<V>): void\r\n    onPerform(callback: OnPerformCallback<V, P>): void;\r\n    onUpdate(callback: OnUpdateCallback<V, P>): void;\r\n    onError(callback: OnErrorCallback<V>): void;\r\n}\r\n\r\nexport class BpdStateWorker<V, P> implements IBpdStateWorker<V, P> {\r\n    private _queue: BpdStateAction<V>[];\r\n    private _queuelock: boolean;\r\n    private _lock: boolean;\r\n    private _onPerform: OnPerformCallback<V, P> | undefined;\r\n    private _onUpdate: OnUpdateCallback<V, P> | undefined;\r\n    private _onError: OnErrorCallback<V> | undefined;\r\n    constructor() {\r\n        this._queue = [];\r\n        this._lock = false;\r\n        this._queuelock = false;\r\n        this._onError = undefined;\r\n        this._onPerform = undefined;\r\n        this._onUpdate = undefined;\r\n\r\n    }\r\n\r\n    onPerform(callback: OnPerformCallback<V, P>) {\r\n        this._onPerform = callback;\r\n    }\r\n\r\n    onUpdate(callback: OnUpdateCallback<V, P>) {\r\n        this._onUpdate = callback;\r\n    }\r\n\r\n    onError(callback: OnErrorCallback<V>) {\r\n        this._onError = callback;\r\n    }\r\n\r\n    perform(action: BpdStateAction<V>) {\r\n        if (!is(action)) {\r\n            throw new IncorrectDataError(\"Inproper action object passed to worker\")\r\n        }\r\n        if (!is(this._onPerform) || !is(this._onUpdate)) {\r\n            throw new WorkerNotReadyError(\"Callbacks are not set\");\r\n        }\r\n        if (!this.isInQueue(action)) {\r\n            this._queue.push(action);\r\n        }\r\n        this.run();\r\n    }\r\n\r\n    private run() {\r\n        if (this._queuelock || this._lock || !is(this._queue)) {\r\n            return;\r\n        }\r\n        this._lock = true;\r\n        let current = this._queue.shift();\r\n        if (!current) {\r\n            this._lock = false;\r\n            this.run();\r\n        }\r\n        if (this._onPerform && current) {\r\n            this._onPerform(current).then((state: P) => {\r\n                if (this._onUpdate) {\r\n                    this._onUpdate(state, current);\r\n                }\r\n                this._lock = false;\r\n                this.run();\r\n            }).catch(e => {\r\n                if (this._onError) {\r\n                    this._onError(e, current);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    private isInQueue(action: BpdStateAction<V>) {\r\n        this._queuelock = true;\r\n        let index = this._queue.findIndex(value => {\r\n            return action.action === value.action && value.data === action.data;\r\n        })\r\n        this._queuelock = false;\r\n        return index > -1;\r\n    }\r\n}","import { IStateBackup, StateBackup } from \"../helpers/backup\";\r\nimport { ObjectCopyMaker } from \"../helpers/copy\";\r\nimport { InitStateError, IncorrectDataError } from \"../helpers/errors\";\r\nimport { is } from \"../helpers/functions\";\r\nimport { BpdStateAction, BpdStateManagerConfig, IObjectCopyMaker, OnChangeEventType, StateMutationHandler } from \"../interfaces\";\r\nimport { ISubscriptionsManager, SubscriptionsManager } from \"../subscriptions/subscriptions\";\r\nimport { IBpdStateWorker, BpdStateWorker } from \"../worker/worker\";\r\n\r\nconst UNDO_ACTION_NAME = \"$$UNDO_FROM_BACKUP\";\r\n\r\nexport interface IBpdState<VState, PAction> {\r\n    perform(action: BpdStateAction<PAction>, callback?: (state: VState) => void | undefined): void;\r\n    subscribe(callback: (state: VState) => void): string | undefined;\r\n    unsubscribe(id: string): boolean;\r\n    getState(): VState;\r\n    undo(): void;\r\n}\r\n\r\nexport class BpdState<VState, PAction> implements IBpdState<VState, PAction> {\r\n    private _state: VState;\r\n    private _backup: IStateBackup<VState>;\r\n    private _id: string;\r\n    private _config: BpdStateManagerConfig<VState>;\r\n    private _worker: IBpdStateWorker<PAction, VState>;\r\n    private _mutationHandler: StateMutationHandler<PAction, VState>;\r\n    private _subscriptionManager: ISubscriptionsManager<VState>;\r\n    private _copyMaker: IObjectCopyMaker<VState>;\r\n\r\n    constructor(id: string, init: VState, mutationHandler: StateMutationHandler<PAction, VState>, config?: BpdStateManagerConfig<VState>) {\r\n        if (!is(id)) {\r\n            throw new InitStateError(\"State id must be provided\")\r\n        }\r\n        if (!is(init)) {\r\n            throw new InitStateError(\"Initial value must be a valid, initialized object\")\r\n        }\r\n        if (!is(mutationHandler)) {\r\n            throw new InitStateError(\"Perfromer callback was not provided\")\r\n        }\r\n        this._id = id;\r\n        this._state = init;\r\n        this._config = config ?? {};\r\n        this._mutationHandler = mutationHandler;\r\n        this._worker = new BpdStateWorker<PAction, VState>();\r\n        this._worker.onUpdate(this.onWorkerChange.bind(this))\r\n        this._worker.onPerform(this.onWorkerPerform.bind(this));\r\n        this._worker.onError(this.onWorkerError.bind(this));\r\n        this._subscriptionManager = new SubscriptionsManager(this._id);\r\n        this._subscriptionManager.onError(this.onSubscriberError.bind(this));\r\n        this._copyMaker = this._config.copyMaker ?? new ObjectCopyMaker();\r\n        this._backup = new StateBackup();\r\n    }\r\n\r\n    /**\r\n     * Performs an action on the state\r\n     * @param action - action to be performed\r\n     * @param callback - optional - subscription callback for one time execution\r\n     */\r\n    perform(action: BpdStateAction<PAction>, callback?: (state: VState) => void) {\r\n        if (!is(action)) {\r\n            this.reportError(\"lib\", \"In proper action object\", new IncorrectDataError(\"In proper action object\"))\r\n        }\r\n        if (callback) {\r\n            this._subscriptionManager.subscribe(callback, {\r\n                singleRun: true\r\n            })\r\n        }\r\n        this._worker.perform(action);\r\n    }\r\n\r\n    /**\r\n     * Attaches new subscriber to state\r\n     * @param callback Function to be assigned to subscriber\r\n     */\r\n    subscribe(callback: (state: VState) => void): string | undefined {\r\n        if (!is(callback)) {\r\n            this.reportError(\"lib\", \"\", new IncorrectDataError(\"Callback has not been set\"))\r\n            return undefined;\r\n        }\r\n        return this._subscriptionManager.subscribe(callback)\r\n    }\r\n\r\n    /**\r\n     * Removes subscriber from the state\r\n     * @param id subscription identifier\r\n     */\r\n    unsubscribe(id: string): boolean {\r\n        if (!is(id)) {\r\n            return false;\r\n        }\r\n        this._subscriptionManager.unsubscribe(id);\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Returns current state\r\n     */\r\n    getState(): VState {\r\n        return this._copyMaker.copy(this._state);\r\n    }\r\n\r\n    /**\r\n     * Performs undo on state\r\n     */\r\n    undo(): void {\r\n        this._worker.perform({ action: UNDO_ACTION_NAME });\r\n    }\r\n\r\n    /**\r\n     * Callback invoked by a worker when state change perform is completed\r\n     * Method assigns new state and calls subscription manager to notify subscribers about the change\r\n     * @param state - new state value\r\n     * @param action - executed action\r\n     */\r\n    private onWorkerChange(state: VState, action?: BpdStateAction<PAction>) {\r\n        if (action && action.action === UNDO_ACTION_NAME) {\r\n            this.assignStateAndNotify(state, \"lib\", \"Undo from backup\");\r\n        } else {\r\n            this._backup.push(this._copyMaker.copy(this._state));\r\n            this.assignStateAndNotify(state, \"action\", action ? action.action : \"\");\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Callback on workerk that creates a promise that executes perfromer on passed action\r\n     * @param action action to be perfromed\r\n     */\r\n    private onWorkerPerform(action: BpdStateAction<PAction>) {\r\n        if (action && action.action === UNDO_ACTION_NAME) {\r\n            return new Promise<VState>((resolve) => {\r\n                let lastValue = this._backup.undo();\r\n                resolve(lastValue ?? this._copyMaker.copy(this._state));\r\n            })\r\n        }\r\n\r\n        return new Promise<VState>((resolve) => {\r\n            resolve(this._mutationHandler(this._copyMaker.copy(this._state), action));\r\n        })\r\n    }\r\n\r\n    private onWorkerError(e: Error, action?: BpdStateAction<PAction>): void {\r\n        this.reportError('action', action ? action.action : \"\", e);\r\n    }\r\n\r\n    private onSubscriberError(e: Error) {\r\n        this.reportError('lib', \"Subscribers error\", e);\r\n    }\r\n\r\n    private reportError(type: OnChangeEventType, detail: string, e: Error) {\r\n        if (this._config && this._config.onError) {\r\n            this._config.onError(this._id, type, e, detail)\r\n        }\r\n    }\r\n\r\n    private reportChange(type: OnChangeEventType, detail: string) {\r\n        if (this._config && this._config.onChange) {\r\n            this._config.onChange(this._id, type, detail, this._state)\r\n        }\r\n    }\r\n\r\n    private assignStateAndNotify(state: VState, type: OnChangeEventType, detail: string) {\r\n        this._state = this._copyMaker.copy(state);\r\n        this._subscriptionManager.notify(state)\r\n            .then((result) => {\r\n                this.reportChange(type, detail)\r\n            })\r\n            .catch(e => {\r\n                this.reportError(type, detail, e)\r\n            })\r\n    }\r\n\r\n}","import { CommonError, CreateStateError, StateManagerShorthandError } from \"./helpers/errors\";\r\nimport { is } from \"./helpers/functions\";\r\nimport { BpdStateManagerConfig, StateMutationHandler, BpdStateAction } from \"./interfaces\";\r\nimport { BpdState, IBpdState } from \"./state/state\";\r\n\r\nexport const VERSION_INFO = \"0.2.0\";\r\n\r\nexport class BpdStateManagerFactory<VStates, TActions> {\r\n    _config: BpdStateManagerConfig<VStates> | undefined;\r\n    _states: Map<string, IBpdState<VStates, TActions>>;\r\n    constructor(config?: BpdStateManagerConfig<VStates>) {\r\n        this._config = config;\r\n        this._states = new Map();\r\n    }\r\n\r\n    createState(name: string, initialValue: VStates, mutationHandler: StateMutationHandler<TActions, VStates>, config?: BpdStateManagerConfig<VStates>) {\r\n        if (!is(name) || is(this._states.get(name))) {\r\n            throw new CreateStateError(\"State name was not provided\");\r\n        }\r\n        this._states.set(name, new BpdState(name, initialValue, mutationHandler, config ?? this._config));\r\n    }\r\n\r\n    removeState(name: string) {\r\n        this.executeIfValid(name, \"RemoveSate\", (state) => {\r\n            this._states.delete(name);\r\n        })\r\n    }\r\n\r\n    getState(name: string): IBpdState<VStates, TActions> | undefined {\r\n        let resultState = undefined;\r\n        this.executeIfValid(name, \"GetState\", (state) => {\r\n            resultState = state;\r\n        })\r\n        return resultState;\r\n    }\r\n\r\n    perform(name: string, action: BpdStateAction<TActions>, callback?: (state: VStates) => void) {\r\n        this.executeIfValid(name, \"Perform\", (state) => {\r\n            state.perform(action, callback);\r\n        })\r\n    }\r\n\r\n    subscribe(name: string, callback: (state: VStates) => void): string | undefined {\r\n        let id = undefined;\r\n        this.executeIfValid(name, \"Subscribe\", (state) => {\r\n            id = state.subscribe(callback);\r\n        })\r\n        return id;\r\n    }\r\n\r\n    unsubscribe(name: string, id: string) {\r\n        this.executeIfValid(name, \"Unsubscribe\", (state) => {\r\n            state.unsubscribe(id);\r\n        })\r\n    }\r\n\r\n    undo(name: string) {\r\n        this.executeIfValid(name, \"Undo\", (state) => {\r\n            state.undo();\r\n        })\r\n    }\r\n\r\n    private executeIfValid(name: string, methodName: string, callback: (state: IBpdState<VStates, TActions>) => void) {\r\n        if (!is(name)) {\r\n            throw new CommonError(methodName + \"Error\", \"State name is not provided\")\r\n        }\r\n        let state = this._states.get(name);\r\n        if (!is(state)) {\r\n            throw new CommonError(methodName + \"StateError\", \"State not found\")\r\n        }\r\n        //@ts-ignore state must exists here\r\n        callback(state);\r\n    }\r\n}\r\n\r\n"],"sourceRoot":""}