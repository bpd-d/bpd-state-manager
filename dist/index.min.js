!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("bpd-toolkit",[],e):"object"==typeof exports?exports["bpd-toolkit"]=e():t["bpd-toolkit"]=e()}(window,(function(){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e),r.d(e,"VERSION_INFO",(function(){return J})),r.d(e,"BpdStateManagerFactory",(function(){return L})),r.d(e,"BpdStateManager",(function(){return X}));class i extends Error{constructor(t,e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=t}}class n extends i{constructor(t){super("IncorrectDataError",t)}}class s extends i{constructor(t){super("WorkerNotReadyError",t)}}class o extends i{constructor(t){super("CreateStateError",t)}}class a extends i{constructor(t){super("InitStateError",t)}}class h extends i{constructor(t,e){super(t,e)}}class c extends i{constructor(t,e){super("StateManagerShorthandError",t+":"+e)}}function u(t){return null!=t&&((!Array.isArray(t)||0!==t.length)&&("string"==typeof t&&t.length,!0))}var d,p,f=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r},l=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class w{constructor(){d.set(this,void 0),p.set(this,void 0),f(this,d,[]),f(this,p,20)}push(t){l(this,d).length>=l(this,p)&&l(this,d).shift(),l(this,d).push(t)}undo(){if(l(this,d).length>0)return l(this,d).pop()}}d=new WeakMap,p=new WeakMap;class b{copy(t){if(null==t)return t;let e=null;return e=["number","string","boolean"].includes(typeof t)||Array.isArray(t)?t:Object.assign({},t),e}}var g,v,S,M,m=function(t,e,r,i){return new(r||(r=Promise))((function(n,s){function o(t){try{h(i.next(t))}catch(t){s(t)}}function a(t){try{h(i.throw(t))}catch(t){s(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,a)}h((i=i.apply(t,e||[])).next())}))},y=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r},k=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class E{constructor(t){if(g.set(this,void 0),v.set(this,void 0),S.set(this,void 0),M.set(this,void 0),!u(t))throw new n("Valid Id is required");y(this,g,[]),y(this,M,t),y(this,S,function*(){let t=0;for(;;){((yield t++)||t>2e5)&&(t=0)}}()),y(this,v,void 0)}subscribe(t,e){let r=this.createSubscriber(t,e);return k(this,g).push(r),r.id}unsubscribe(t){if(!u(t))return;let e=k(this,g).findIndex(e=>e.id===t);e<0||k(this,g).splice(e,1)}notify(t){return m(this,void 0,void 0,(function*(){let e=[];return k(this,g).forEach(r=>{r.options&&r.options.singleRun&&e.push(r.id);try{r.callback(t)}catch(t){e.push(r.id),k(this,v)&&k(this,v).call(this,t)}}),e.forEach(t=>this.unsubscribe(t)),!0}))}onError(t){y(this,v,t)}getSubscribers(){return[...k(this,g)]}createSubscriber(t,e){return{id:this.generateId(),options:e,callback:t}}generateId(){return`${k(this,M)}:${k(this,S).next().value}`}}g=new WeakMap,v=new WeakMap,S=new WeakMap,M=new WeakMap;var W,x,$,I,P,O,j=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r},T=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class _{constructor(){W.set(this,void 0),x.set(this,void 0),$.set(this,void 0),I.set(this,void 0),P.set(this,void 0),O.set(this,void 0),j(this,W,[]),j(this,$,!1),j(this,x,!1),j(this,O,void 0),j(this,I,void 0),j(this,P,void 0)}onPerform(t){j(this,I,t)}onUpdate(t){j(this,P,t)}onError(t){j(this,O,t)}perform(t){if(!u(t))throw new n("Inproper action object passed to worker");if(!u(T(this,I))||!u(T(this,P)))throw new s("Callbacks are not set");this.isInQueue(t)||T(this,W).push(t),this.run()}run(){if(T(this,x)||T(this,$)||!u(T(this,W)))return;j(this,$,!0);let t=T(this,W).shift();t||(j(this,$,!1),this.run()),T(this,I)&&t&&T(this,I).call(this,t).then(e=>{T(this,P)&&T(this,P).call(this,e,t),j(this,$,!1),this.run()}).catch(e=>{T(this,O)&&T(this,O).call(this,e,t)})}isInQueue(t){j(this,x,!0);let e=T(this,W).findIndex(e=>t.action===e.action&&e.data===t.data);return j(this,x,!1),e>-1}}W=new WeakMap,x=new WeakMap,$=new WeakMap,I=new WeakMap,P=new WeakMap,O=new WeakMap;var C,A,U,N,V,z,R,F,B=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r},D=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class K{constructor(t,e,r,i){var n;if(C.set(this,void 0),A.set(this,void 0),U.set(this,void 0),N.set(this,void 0),V.set(this,void 0),z.set(this,void 0),R.set(this,void 0),F.set(this,void 0),!u(t))throw new a("State id must be provided");if(!u(e))throw new a("Initial value must be a valid, initialized object");if(!u(r))throw new a("Perfromer callback was not provided");B(this,U,t),B(this,C,e),B(this,N,null!=i?i:{}),B(this,z,r),B(this,V,new _),D(this,V).onUpdate(this.onWorkerChange.bind(this)),D(this,V).onPerform(this.onWorkerPerform.bind(this)),D(this,V).onError(this.onWorkerError.bind(this)),B(this,R,new E(D(this,U))),D(this,R).onError(this.onSubscriberError.bind(this)),B(this,F,null!==(n=D(this,N).copyMaker)&&void 0!==n?n:new b),B(this,A,new w)}perform(t,e){u(t)||this.reportError("lib","In proper action object",new n("In proper action object")),e&&D(this,R).subscribe(e,{singleRun:!0}),D(this,V).perform(t)}subscribe(t){if(u(t))return D(this,R).subscribe(t);this.reportError("lib","",new n("Callback has not been set"))}unsubscribe(t){return!!u(t)&&(D(this,R).unsubscribe(t),!0)}getState(){return D(this,F).copy(D(this,C))}undo(){D(this,V).perform({action:"$$UNDO_FROM_BACKUP"})}onWorkerChange(t,e){e&&"$$UNDO_FROM_BACKUP"===e.action?this.assignStateAndNotify(t,"lib","Undo from backup"):(D(this,A).push(D(this,F).copy(D(this,C))),this.assignStateAndNotify(t,"action",e?e.action:""))}onWorkerPerform(t){return t&&"$$UNDO_FROM_BACKUP"===t.action?new Promise(t=>{let e=D(this,A).undo();t(null!=e?e:D(this,F).copy(D(this,C)))}):new Promise(e=>{e(D(this,z).call(this,D(this,F).copy(D(this,C)),t))})}onWorkerError(t,e){this.reportError("action",e?e.action:"",t)}onSubscriberError(t){this.reportError("lib","Subscribers error",t)}reportError(t,e,r){D(this,N)&&D(this,N).onError&&D(this,N).onError(D(this,U),t,r,e)}reportChange(t,e){D(this,N)&&D(this,N).onChange&&D(this,N).onChange(D(this,U),t,e,D(this,C))}assignStateAndNotify(t,e,r){B(this,C,D(this,F).copy(t)),D(this,R).notify(t).then(t=>{this.reportChange(e,r)}).catch(t=>{this.reportError(e,r,t)})}}C=new WeakMap,A=new WeakMap,U=new WeakMap,N=new WeakMap,V=new WeakMap,z=new WeakMap,R=new WeakMap,F=new WeakMap;var Q,q,G=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r},H=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};const J="0.1.1";class L{constructor(t){Q.set(this,void 0),q.set(this,void 0),G(this,Q,t),G(this,q,{})}createState(t,e,r,i){if(!u(t))throw new o("State name was not provided");H(this,q)[t]=new K(t,e,r,null!=i?i:H(this,Q))}removeState(t){this.executeIfValid(t,"Perform",e=>{delete H(this,q)[t]})}getState(t){let e=void 0;return this.executeIfValid(t,"Perform",t=>{e=t}),e}perform(t,e,r){this.executeIfValid(t,"Perform",t=>{t.perform(e,r)})}subscribe(t,e){let r=void 0;return this.executeIfValid(t,"Subscribe",t=>{r=t.subscribe(e)}),r}unsubscribe(t,e){this.executeIfValid(t,"Unsubscribe",t=>{t.unsubscribe(e)})}undo(t){this.executeIfValid(t,"Undo",t=>{t.undo()})}executeIfValid(t,e,r){if(!u(t))throw new h(e+"Error","State name is not provided");let i=H(this,q)[t];if(!u(i))throw new h(e+"StateError","State not found");r(i)}}Q=new WeakMap,q=new WeakMap;class X{static createStateManager(t){window.$bdpStateManager=new L(t)}static createState(t,e,r,i){if(!u(window.$bdpStateManager))throw new c("createState","Manager must be initialized first with createStateManager");window.$bdpStateManager.createState(t,e,r,i)}static removeState(t){if(!u(window.$bdpStateManager))throw new c("removeState","Manager must be initialized first with createStateManager");window.$bdpStateManager.removeState(t)}static getState(t){if(!u(window.$bdpStateManager))throw new c("getState","Manager must be initialized first with createStateManager");return window.$bdpStateManager.getState(t)}static performStateAction(t,e,r){if(!u(window.$bdpStateManager))throw new c("perform","Manager must be initialized first with createStateManager");window.$bdpStateManager.perform(t,e,r)}static subscribeToState(t,e){if(!u(window.$bdpStateManager))throw new c("subscribe","Manager must be initialized first with createStateManager");return window.$bdpStateManager.subscribe(t,e)}static unsubscribeFromState(t,e){if(!u(window.$bdpStateManager))throw new c("unsubscribe","Manager must be initialized first with createStateManager");window.$bdpStateManager.unsubscribe(t,e)}static undoState(t){if(!u(window.$bdpStateManager))throw new c("unsubscribe","Manager must be initialized first with createStateManager");window.$bdpStateManager.undo(t)}}}])}));
//# sourceMappingURL=index.min.js.map