!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("bpd-toolkit",[],e):"object"==typeof exports?exports["bpd-toolkit"]=e():t["bpd-toolkit"]=e()}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e),r.d(e,"VERSION_INFO",(function(){return Q})),r.d(e,"BpdStateManager",(function(){return q})),r.d(e,"createStateManager",(function(){return B})),r.d(e,"createState",(function(){return D})),r.d(e,"removeState",(function(){return F})),r.d(e,"getState",(function(){return G})),r.d(e,"perform",(function(){return H})),r.d(e,"subscribe",(function(){return J})),r.d(e,"unsubscribe",(function(){return K}));class n extends Error{constructor(t,e){super(e),Object.setPrototypeOf(this,new.target.prototype),this.name=t}}class i extends n{constructor(t){super("IncorrectDataError",t)}}class o extends n{constructor(t){super("WorkerNotReadyError",t)}}class s extends n{constructor(t){super("CreateStateError",t)}}class a extends n{constructor(t){super("InitStateError",t)}}class u extends n{constructor(t,e){super(t,e)}}class c extends n{constructor(t,e){super("StateManagerShorthandError",t+":"+e)}}function h(t){return null!=t&&((!Array.isArray(t)||0!==t.length)&&("string"==typeof t&&t.length,!0))}var d,f,p,l,b=function(t,e,r,n){return new(r||(r=Promise))((function(i,o){function s(t){try{u(n.next(t))}catch(t){o(t)}}function a(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}u((n=n.apply(t,e||[])).next())}))},w=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r},g=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class v{constructor(t){if(d.set(this,void 0),f.set(this,void 0),p.set(this,void 0),l.set(this,void 0),!h(t))throw new i("Valid Id is required");w(this,d,[]),w(this,l,t),w(this,p,function*(){let t=0;for(;;){((yield t++)||t>2e5)&&(t=0)}}()),w(this,f,void 0)}subscribe(t,e){let r=this.createSubscriber(t,e);return g(this,d).push(r),r.id}unsubscribe(t){if(!h(t))return;let e=g(this,d).findIndex(e=>e.id===t);e<0||g(this,d).splice(e,1)}notify(t){return b(this,void 0,void 0,(function*(){let e=[];return g(this,d).forEach(r=>{r.options&&r.options.singleRun&&e.push(r.id);try{r.callback(t)}catch(t){e.push(r.id),g(this,f)&&g(this,f).call(this,t)}}),e.forEach(t=>this.unsubscribe(t)),!0}))}onError(t){w(this,f,t)}getSubscribers(){return[...g(this,d)]}createSubscriber(t,e){return{id:this.generateId(),options:e,callback:t}}generateId(){return`${g(this,l)}:${g(this,p).next().value}`}}d=new WeakMap,f=new WeakMap,p=new WeakMap,l=new WeakMap;var S,m,M,y,E,k,x=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r},W=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class I{constructor(){S.set(this,void 0),m.set(this,void 0),M.set(this,void 0),y.set(this,void 0),E.set(this,void 0),k.set(this,void 0),x(this,S,[]),x(this,M,!1),x(this,m,!1),x(this,k,void 0),x(this,y,void 0),x(this,E,void 0)}onPerform(t){x(this,y,t)}onUpdate(t){x(this,E,t)}onError(t){x(this,k,t)}perform(t){if(!h(t))throw new i("Inproper action object passed to worker");if(!h(W(this,y))||!h(W(this,E)))throw new o("Callbacks are not set");this.isInQueue(t)||W(this,S).push(t),this.run()}run(){if(W(this,m)||W(this,M)||!h(W(this,S)))return;x(this,M,!0);let t=W(this,S).shift();t||(x(this,M,!1),this.run()),W(this,y)&&t&&W(this,y).call(this,t).then(e=>{W(this,E)&&W(this,E).call(this,e,t),x(this,M,!1),this.run()}).catch(e=>{W(this,k)&&W(this,k).call(this,e,t)})}isInQueue(t){x(this,m,!0);let e=W(this,S).findIndex(e=>t.action===e.action&&e.data===t.data);return x(this,m,!1),e>-1}}S=new WeakMap,m=new WeakMap,M=new WeakMap,y=new WeakMap,E=new WeakMap,k=new WeakMap;var j,P,$,O,T,C,V=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r},z=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class _{constructor(t,e,r,n){if(j.set(this,void 0),P.set(this,void 0),$.set(this,void 0),O.set(this,void 0),T.set(this,void 0),C.set(this,void 0),!h(t))throw new a("State id must be provided");if(!h(e))throw new a("Initial value must be a valid, initialized object");if(!h(r))throw new a("Perfromer callback was not provided");V(this,P,t),V(this,j,e),V(this,$,null!=n?n:{}),V(this,T,r),V(this,O,new I),z(this,O).onUpdate(this.onWorkerChange.bind(this)),z(this,O).onPerform(this.onWorkerPerform.bind(this)),z(this,O).onError(this.onWorkerError.bind(this)),V(this,C,new v(z(this,P))),z(this,C).onError(this.onSubscriberError.bind(this))}perform(t,e){h(t)||this.reportError("lib","In proper action object",new i("In proper action object")),e&&z(this,C).subscribe(e,{singleRun:!0}),z(this,O).perform(t)}subscribe(t){if(h(t))return z(this,C).subscribe(t);this.reportError("lib","",new i("Callback has not been set"))}unsubscribe(t){return!!h(t)&&(z(this,C).unsubscribe(t),!0)}getState(){return z(this,j)}onWorkerChange(t,e){["number","string","boolean"].includes(typeof t)||Array.isArray(t)?V(this,j,t):V(this,j,Object.assign({},t)),z(this,C).notify(t).then(t=>{this.reportChange("action",e?e.action:"")}).catch(t=>{this.reportError("action",e?e.action:"",t)})}onWorkerPerform(t){return new Promise(e=>{e(z(this,T).call(this,z(this,j),t))})}onWorkerError(t,e){this.reportError("action",e?e.action:"",t)}onSubscriberError(t){this.reportError("lib","Subscribers error",t)}reportError(t,e,r){z(this,$)&&z(this,$).onError&&z(this,$).onError(z(this,P),t,r,e)}reportChange(t,e){z(this,$)&&z(this,$).onChange&&z(this,$).onChange(z(this,P),t,e,z(this,j))}}j=new WeakMap,P=new WeakMap,$=new WeakMap,O=new WeakMap,T=new WeakMap,C=new WeakMap;var A,R,N=function(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r},U=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};const Q="0.1.0";class q{constructor(t){A.set(this,void 0),R.set(this,void 0),N(this,A,t),N(this,R,{})}createState(t,e,r,n){if(!h(t))throw new s("State name was not provided");U(this,R)[t]=new _(t,e,r,null!=n?n:U(this,A))}removeState(t){this.executeIfValid(t,"Perform",e=>{delete U(this,R)[t]})}getState(t){let e=void 0;return this.executeIfValid(t,"Perform",t=>{e=t}),e}perform(t,e,r){this.executeIfValid(t,"Perform",t=>{t.perform(e,r)})}subscribe(t,e){let r=void 0;return this.executeIfValid(t,"Subscribe",t=>{r=t.subscribe(e)}),r}unsubscribe(t,e){this.executeIfValid(t,"Unsubscribe",t=>{t.unsubscribe(e)})}executeIfValid(t,e,r){if(!h(t))throw new u(e+"Error","State name is not provided");let n=U(this,R)[t];if(!h(n))throw new u(e+"StateError","State not found");r(n)}}function B(t){window.$bdpStateManager=new q(t)}function D(t,e,r,n){if(!h(window.$bdpStateManager))throw new c("createState","Manager must be initialized first with createStateManager");window.$bdpStateManager.createState(t,e,r,n)}function F(t){if(!h(window.$bdpStateManager))throw new c("removeState","Manager must be initialized first with createStateManager");window.$bdpStateManager.removeState(t)}function G(t){if(!h(window.$bdpStateManager))throw new c("getState","Manager must be initialized first with createStateManager");return window.$bdpStateManager.getState(t)}function H(t,e,r){if(!h(window.$bdpStateManager))throw new c("perform","Manager must be initialized first with createStateManager");window.$bdpStateManager.perform(t,e,r)}function J(t,e){if(!h(window.$bdpStateManager))throw new c("subscribe","Manager must be initialized first with createStateManager");return window.$bdpStateManager.subscribe(t,e)}function K(t,e){if(!h(window.$bdpStateManager))throw new c("unsubscribe","Manager must be initialized first with createStateManager");window.$bdpStateManager.unsubscribe(t,e)}A=new WeakMap,R=new WeakMap}])}));
//# sourceMappingURL=index.min.js.map